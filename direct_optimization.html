---

title: Direct Optimization


keywords: fastai
sidebar: home_sidebar

summary: "Let's leave the physics simulator out of it for now..."
description: "Let's leave the physics simulator out of it for now..."
nb_path: "notebooks/05_direct_optimization.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/05_direct_optimization.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="target">target<a class="anchor-link" href="#target"> </a></h3><p>Let's - for now - just try to find a pre-defined design target (which we will construct with our generator)...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">brush_target</span> <span class="o">=</span> <span class="n">notched_square_brush</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">latent_target</span> <span class="o">=</span> <span class="n">new_latent_design</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">latent_target_t</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">latent_target</span><span class="p">,</span> <span class="n">brush_target</span><span class="p">)</span>
<span class="n">mask_target</span> <span class="o">=</span> <span class="n">generate_feasible_design_mask</span><span class="p">(</span><span class="n">latent_target_t</span><span class="p">,</span> <span class="n">brush_target</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_target</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:absl:No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="input">input<a class="anchor-link" href="#input"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">brush_input</span> <span class="o">=</span> <span class="n">notched_square_brush</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">latent_input</span> <span class="o">=</span> <span class="n">new_latent_design</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">latent_input_t</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">latent_input</span><span class="p">,</span> <span class="n">brush_input</span><span class="p">)</span>
<span class="n">mask_input</span> <span class="o">=</span> <span class="n">generate_feasible_design_mask</span><span class="p">(</span><span class="n">latent_input_t</span><span class="p">,</span> <span class="n">brush_target</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_input</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loss-Functions">Loss Functions<a class="anchor-link" href="#Loss-Functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mse" class="doc_header"><code>mse</code><a href="https://github.com/flaport/inverse_design/tree/master/inverse_design/direct_optimization.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mse</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="huber_loss" class="doc_header"><code>huber_loss</code><a href="https://github.com/flaport/inverse_design/tree/master/inverse_design/direct_optimization.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>huber_loss</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>, <strong><code>delta</code></strong>=<em><code>0.5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Optimization">Optimization<a class="anchor-link" href="#Optimization"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>the loss function defines what we're optimizing.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">):</span>
    <span class="n">latent_t</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">)</span>
    <span class="n">design_mask</span> <span class="o">=</span> <span class="n">generate_feasible_design_mask</span><span class="p">(</span><span class="n">latent_t</span><span class="p">,</span> <span class="n">brush</span><span class="p">)</span> <span class="c1"># differentiable through STE</span>
    <span class="k">return</span> <span class="n">design_mask</span>
    
<span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">,</span> <span class="n">target_mask</span><span class="p">):</span>
    <span class="n">design_mask</span> <span class="o">=</span> <span class="n">forward</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">huber_loss</span><span class="p">(</span><span class="n">design_mask</span><span class="p">,</span> <span class="n">target_mask</span><span class="p">)</span>

<span class="n">loss_fn</span><span class="p">(</span><span class="n">latent_input</span><span class="p">,</span> <span class="n">brush_input</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DeviceArray(0.41641316, dtype=float32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>using jax, it's easy to get the gradient function.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grad_fn</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">,</span> <span class="n">argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let's use an Adam optimizer</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">init_fn</span><span class="p">,</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">params_fn</span> <span class="o">=</span> <span class="n">adam</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">init_fn</span><span class="p">(</span><span class="n">latent_input</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>this is the optimization step:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">brush</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">):</span>
    <span class="n">latent</span> <span class="o">=</span> <span class="n">params_fn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">)</span>
    <span class="n">grads</span> <span class="o">=</span> <span class="n">grad_fn</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">brush</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">)</span>
    <span class="n">optim_state</span> <span class="o">=</span> <span class="n">update_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">grads</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">optim_state</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we can now loop over the optimization:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">range_</span> <span class="o">=</span> <span class="n">trange</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">range_</span><span class="p">:</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">step_fn</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">brush_input</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">)</span>
    <span class="n">range_</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">loss</span><span class="p">))</span>
<span class="n">latent_input</span> <span class="o">=</span> <span class="n">params_fn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_target</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_input</span><span class="p">,</span> <span class="n">brush_input</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loss_fn</span><span class="p">(</span><span class="n">latent_input</span><span class="p">,</span> <span class="n">brush_input</span><span class="p">,</span> <span class="n">mask_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DeviceArray(0.02515835, dtype=float32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

<script type="application/vnd.jupyter.widget-state+json">
{"state": {"122a7928acd34ca0a9c1a5f7f0240284": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_861b17062b184c638f74e8d497ba60fb", "placeholder": "\u200b", "style": "IPY_MODEL_7fcdf593565641098de1ef25d3c99ed5", "value": "100%"}}, "172334caa09646e8826f66b81a629502": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_260618640e1d46e590a4f519a4a84435", "max": 50.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_e9a348989c034558915735dd047cde5b", "value": 50.0}}, "260618640e1d46e590a4f519a4a84435": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3a46175bc08d46c7b96ba18992257235": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "5165427e3fb14425864233dcc10ff097": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "7fcdf593565641098de1ef25d3c99ed5": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "861b17062b184c638f74e8d497ba60fb": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "88220dfe3102467bba436bf480873c45": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d0cad26e4d4244f79bd315bc7d03e968": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_5165427e3fb14425864233dcc10ff097", "placeholder": "\u200b", "style": "IPY_MODEL_3a46175bc08d46c7b96ba18992257235", "value": " 50/50 [01:48&lt;00:00,  2.09s/it, loss=0.0252]"}}, "e9a348989c034558915735dd047cde5b": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "eb1af220977342dc88b10284076be87d": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_122a7928acd34ca0a9c1a5f7f0240284", "IPY_MODEL_172334caa09646e8826f66b81a629502", "IPY_MODEL_d0cad26e4d4244f79bd315bc7d03e968"], "layout": "IPY_MODEL_88220dfe3102467bba436bf480873c45"}}}, "version_major": 2, "version_minor": 0}
</script>

